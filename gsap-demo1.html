<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GSAP橫向捲動網站範例</title>
  <style>
    :root { --bg:#0f1220; --fg:#eef2ff; --muted:#a3aed0; --brand:#7c3aed; --hdr:rgba(15,18,32,.85);}    
    html { scroll-behavior: smooth; }
    html, body { height: 100%; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans; color: var(--fg); background: var(--bg); overflow-x: hidden; }
    a { color: inherit; text-decoration: none; }

    /* Header */
    .site-header { position: fixed; inset: 0 0 auto 0; height: 64px; display: flex; align-items: center; justify-content: space-between; padding: 0 16px; background: var(--hdr); backdrop-filter: saturate(180%) blur(10px); z-index: 50; border-bottom: 1px solid rgba(255,255,255,.08); }
    .brand { display: inline-flex; align-items: center; gap: 10px; font-weight: 700; }
    .brand-dot { width: 8px; height: 8px; border-radius: 999px; background: var(--brand); box-shadow: 0 0 0 4px rgba(124,58,237,.25); }
    .nav { display: none; gap: 16px; }
    .hamb { display: inline-flex; align-items: center; gap: 8px; cursor: pointer; border: 1px solid rgba(255,255,255,.12); padding: 6px 10px; border-radius: 10px; }
    .hamb span { width: 18px; height: 2px; background: var(--fg); display: block; box-shadow: 0 6px 0 0 var(--fg), 0 -6px 0 0 var(--fg); }

    /* Fullscreen Off‑Canvas */
    .offcanvas-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.55); opacity: 0; pointer-events: none; transition: opacity .25s ease; z-index: 60; }
    .offcanvas { position: fixed; top:0; left:0; height: 100dvh; width: 100vw; background: #11162b; transform: translateX(100%); transition: transform .3s cubic-bezier(.2,.8,.2,1); z-index: 70; display: grid; grid-template-rows: 64px 1fr auto; }
    .offcanvas header { display:flex; align-items:center; padding: 0 16px; border-bottom: 1px solid rgba(255,255,255,.08); }
    .offcanvas .close { margin-left: auto; border: 1px solid rgba(255,255,255,.12); padding: 6px 10px; border-radius: 10px; cursor: pointer; }
    .offcanvas nav { padding: 16px; display: grid; gap: 10px; }
    .offcanvas footer { padding: 16px; color: var(--muted); border-top: 1px solid rgba(255,255,255,.08); }
    .off-open .offcanvas { transform: translateX(0); }
    .off-open .offcanvas-backdrop { opacity: 1; pointer-events: auto; }
    body.off-open { overflow: hidden; }

    /* Panels */
    .wrap { position: relative; }
    .panels { display: flex; height: 100vh; width: 100%; }
    .panel { min-width: 100vw; height: 100vh; display: grid; place-items: center; padding: 64px 6vw 6vw; box-sizing: border-box; }
    .panel h2 { font-size: clamp(28px, 5vw, 56px); margin: 0 0 8px; }
    .panel p { color: var(--muted); max-width: 60ch; text-align: center; }
    .p1 { background: radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,.25), transparent) no-repeat; }
    .p2 { background: radial-gradient(1000px 500px at 90% 30%, rgba(34,211,238,.18), transparent) no-repeat; }
    .p3 { background: radial-gradient(1000px 500px at 50% 90%, rgba(59,130,246,.18), transparent) no-repeat; }

    .progress { position: fixed; left: 0; top: 64px; height: 3px; width: 0; background: linear-gradient(90deg, var(--brand), #22d3ee); z-index: 55; }

    /* Pagination (底部置中) */
    .pagination { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; z-index: 80; }
    .pagination button { width: 12px; height: 12px; border-radius: 50%; border: none; background: rgba(255,255,255,0.3); cursor: pointer; }
    .pagination button.active { background: var(--brand); box-shadow: 0 0 6px rgba(124,58,237,.6); }

    @media (min-width: 1024px) {
      .nav { display: inline-flex; }
      .wrap { height: 100vh; }
      .panels { width: auto; }
    }

    @media (max-width: 1023.98px) {
      .panels { display: block; }
      .panel { min-width: auto; height: 100dvh; }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="brand"><span class="brand-dot"></span><span>GSAP橫向捲動網站</span></div>
    <nav class="nav">
      <a href="#s1">Home</a>
      <a href="#s2">Features</a>
      <a href="#s3">Contact</a>
    </nav>
    <button id="openOff" class="hamb"><span></span> Menu</button>
  </header>

  <div class="progress" id="progress"></div>

  <div class="offcanvas-backdrop" id="backdrop"></div>
  <aside id="offcanvas" class="offcanvas" aria-modal="true" role="dialog" aria-label="Off‑canvas menu">
    <header>
      <strong>Quick Menu</strong>
      <button id="closeOff" class="close">Close</button>
    </header>
    <nav>
      <a href="#s1" class="oc-link">Home</a>
      <a href="#s2" class="oc-link">Features</a>
      <a href="#s3" class="oc-link">Contact</a>
    </nav>
    <footer><small>© 2025 GSAP橫向捲動網站</small></footer>
  </aside>

  <main class="wrap">
    <section id="s1" class="panels">
      <article class="panel p1"><div><h2>GSAP橫向捲動網站</h2><p>Desktop: horizontal scroll. Mobile: vertical layout.</p></div></article>
      <article class="panel p2"><div><h2>Section1</h2><p>ScrollTrigger manages pinning and snapping.</p></div></article>
      <article class="panel p3"><div><h2>Section2</h2><p>Off‑canvas now covers the full screen.</p></div></article>
    </section>
  </main>

  <div class="pagination" id="pagination" aria-label="Section pagination"></div>

  <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/ScrollTrigger.min.js"></script>
  <script>
    // ===== Off‑Canvas =====
    const body = document.body;
    const openBtn = document.getElementById('openOff');
    const closeBtn = document.getElementById('closeOff');
    const backdrop = document.getElementById('backdrop');
    const ocLinks = Array.from(document.querySelectorAll('.oc-link'));
    let lastFocus;
    function openOff(){ lastFocus=document.activeElement; body.classList.add('off-open'); }
    function closeOff(){ body.classList.remove('off-open'); lastFocus&&lastFocus.focus(); }
    openBtn.addEventListener('click', openOff);
    closeBtn.addEventListener('click', closeOff);
    backdrop.addEventListener('click', closeOff);
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeOff(); });
    ocLinks.forEach(a=> a.addEventListener('click', closeOff));

    // ===== GSAP Horizontal on Desktop, Vertical on Mobile =====
    gsap.registerPlugin(ScrollTrigger);
    const mm = gsap.matchMedia();

    const panels = gsap.utils.toArray('.panel');
    const container = document.querySelector('.panels');
    const progressBar = document.getElementById('progress');
    const pagination = document.getElementById('pagination');

    // Helper: build pagination dots
    function buildDots(onClick){
      pagination.innerHTML = '';
      panels.forEach((_, i) => {
        const b = document.createElement('button');
        b.type = 'button';
        b.setAttribute('aria-label', `Go to section ${i+1}`);
        b.addEventListener('click', () => onClick(i));
        pagination.appendChild(b);
      });
    }

    function setActiveDot(idx){
      Array.from(pagination.children).forEach((el, i)=> el.classList.toggle('active', i===idx));
    }

    mm.add({ isDesktop:"(min-width: 1024px)", isMobile:"(max-width: 1023.98px)" }, (ctx) => {
      const { isDesktop } = ctx.conditions;
      let stMain;

      if (isDesktop) {
        // Desktop: Horizontal scroll
        gsap.set(container, { width: () => panels.length * innerWidth });
        // Create ScrollTrigger with attached animation
        stMain = ScrollTrigger.create({
          trigger: container,
          start: "top top",
          end: () => "+=" + (container.scrollWidth - innerWidth),
          scrub: 0.6,
          pin: true,
          anticipatePin: 1,
          invalidateOnRefresh: true,
          animation: gsap.to(container, { x: () => -(container.scrollWidth - innerWidth), ease: 'none' }),
          onUpdate: (self) => {
            progressBar.style.width = Math.round(self.progress * 100) + '%';
            const idx = Math.round(self.progress * (panels.length - 1));
            setActiveDot(idx);
          }
        });
        // Optional snap
        ScrollTrigger.create({
          trigger: container,
          start: "top top",
          end: () => "+=" + (container.scrollWidth - innerWidth),
          snap: 1 / (panels.length - 1),
          scrub: 0.2
        });

        // Pagination clicks → scroll to segment smoothly
        buildDots((i) => {
          const total = Math.max(1, panels.length - 1);
          const target = (container.scrollWidth - innerWidth) * (i / total);
          window.scrollTo({ top: stMain.start + target, behavior: 'smooth' });
        });
        setActiveDot(0);
        window.addEventListener('resize', () => ScrollTrigger.refresh());

      } else {
        // Mobile: vertical native scroll
        gsap.set(container, { clearProps: 'width,x' });
        gsap.set('.panel', { clearProps: 'minWidth' });
        progressBar.style.width = '0%';

        // Pagination clicks → native smooth scroll
        buildDots((i) => panels[i].scrollIntoView({ behavior: 'smooth', block: 'start' }));
        setActiveDot(0);

        // Active dot via IntersectionObserver
        const io = new IntersectionObserver((entries) => {
          const v = entries.filter(e=>e.isIntersecting).sort((a,b)=> b.intersectionRatio - a.intersectionRatio)[0];
          if (v) setActiveDot(panels.indexOf(v.target));
        }, { threshold: [0.55] });
        panels.forEach(p => io.observe(p));
      }

      return () => {
        // Cleanup when breakpoint changes
        ScrollTrigger.getAll().forEach(st => st.kill());
        gsap.set('.panels', { clearProps: 'all' });
      };
    });
  </script>
</body>
</html>
