<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>GSAP Rich Parallax – Layers / Mouse / Pin / Horizontal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --pad: clamp(16px, 4vw, 42px);
      --mx: 0; /* mouse x (-1~1) */
      --my: 0; /* mouse y (-1~1) */
    }
    * { box-sizing: border-box; margin: 0; }
    body { font-family: system-ui, -apple-system, "Noto Sans TC", Inter, Arial, sans-serif; background:#0b0b0c; color:#fff; }
    a { color: inherit; }

    .nav {
      position: sticky; top: 0; z-index: 1000;
      display: flex; gap: 10px; align-items: center; padding: 10px var(--pad);
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: color-mix(in oklab, #0b0b0c 80%, transparent);
      backdrop-filter: blur(8px) saturate(120%);
    }
    .nav a { text-decoration: none; padding: 6px 10px; border: 1px solid rgba(255,255,255,.16); border-radius: 999px; }
    .nav a:hover { background: rgba(255,255,255,.06); }

    section { position: relative; min-height: 100vh; padding: var(--pad); display: grid; place-items: center; overflow: clip; }
    .wrap { width: min(1200px, 100%); margin: 0 auto; }
    .card {
      background: rgba(0,0,0,.42);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 20px;
      padding: clamp(16px,3vw,28px);
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    h1,h2 { line-height: 1.15; margin-bottom: .5rem; }
    p { color: #e6e6e6; }

    /* ===== Hero: multi-depth layers + mouse parallax ===== */
    .hero {
      display: grid; place-items: center; text-align: center;
    }
    .layers { position: absolute; inset: -10% -2%; z-index: -1; }
    .layer {
      position: absolute; inset: 0;
      background-size: cover; background-position: center;
      will-change: transform;
      transform: translate3d(0,0,0) scale(1.05);
      filter: saturate(1.05) contrast(1.05);
    }
    .l-back    { background-image: url('https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1920&auto=format&fit=crop'); }
    .l-midfar  { background-image: url('https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1920&auto=format&fit=crop'); mix-blend-mode: screen; opacity:.6; }
    .l-mid     { background-image: url('https://images.unsplash.com/photo-1517817748492-58a3b057a7b6?q=80&w=1920&auto=format&fit=crop'); opacity:.9;}
    .l-midnear { background-image: url('https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1920&auto=format&fit=crop'); mix-blend-mode: overlay; opacity:.7; }
    .l-front   { background-image: url('https://images.unsplash.com/photo-1469474968028-56623f02e42e?q=80&w=1920&auto=format&fit=crop'); opacity:.65; }

    .hero .headline {
      max-width: 900px;
      padding: clamp(16px, 4vw, 40px);
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,.15);
      background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.2));
      backdrop-filter: blur(4px);
      clip-path: inset(0 0 0 0 round 24px);
    }
    .hero .kicker { letter-spacing: .12em; text-transform: uppercase; font-size: .95rem; opacity:.8; }
    .hero h1 { font-size: clamp(32px, 6vw, 60px); }
    .hero p { margin-top: .25rem; opacity:.9; }

    /* small floating foreground chips that also mouse-parallax */
    .chips {
      position: absolute; inset: 0; pointer-events: none;
    }
    .chip {
      position: absolute; padding: 8px 12px; border-radius: 12px;
      background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.18);
      box-shadow: 0 10px 30px rgba(0,0,0,.3);
      transform: translate3d(0,0,0);
      will-change: transform;
    }
    .chip.c1 { top: 18%; left: 12%; }
    .chip.c2 { top: 28%; right: 10%; }
    .chip.c3 { bottom: 20%; left: 20%; }
    .chip.c4 { bottom: 18%; right: 18%; }

    /* ===== Horizontal parallax strip ===== */
    .hstrip { background: #0f0f12; }
    .track {
      display: flex; gap: clamp(16px,2vw,24px);
      will-change: transform;
    }
    .panel {
      flex: 0 0 clamp(70%, 60vw, 800px);
      aspect-ratio: 16/9;
      background-size: cover; background-position: center;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 20px 50px rgba(0,0,0,.35);
    }
    .p1 { background-image: url('https://images.unsplash.com/photo-1491553895911-0055eca6402d?q=80&w=1600&auto=format&fit=crop'); }
    .p2 { background-image: url('https://images.unsplash.com/photo-1470770903676-69b98201ea1c?q=80&w=1600&auto=format&fit=crop'); }
    .p3 { background-image: url('https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?q=80&w=1600&auto=format&fit=crop'); }
    .p4 { background-image: url('https://images.unsplash.com/photo-1500534319937-4048f7b3a1d0?q=80&w=1600&auto=format&fit=crop'); }

    /* ===== Clip-path reveal section ===== */
    .reveal {
      background: #0b0b0c;
    }
    .reveal .bg {
      position: absolute; inset: 0;
      background-image: url('https://images.unsplash.com/photo-1519389950473-47ba0277781c?q=80&w=1920&auto=format&fit=crop');
      background-size: cover; background-position: center 0;
      filter: saturate(1.08);
      z-index: -1;
      will-change: transform;
    }
    .reveal .wrap {
      display: grid; gap: 18px;
    }
    .mask {
      display: inline-block;
      clip-path: inset(0 100% 0 0);
      will-change: clip-path, transform, opacity;
    }

    /* ===== Card grid with depth ===== */
    .grid { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); }
    .grid .card { min-height: 160px; }

    /* reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .layer, .chip, .bg { transform: none !important; }
    }
  </style>
</head>
<body>

  <nav class="nav">
    <strong>Rich Parallax</strong>
    <a href="#hero">Hero</a>
    <a href="#hstrip">Horizontal</a>
    <a href="#reveal">Reveal</a>
    <a href="#cards">Cards</a>
  </nav>

  <!-- ===== HERO: Multi-depth + Mouse + Pin ===== -->
  <section id="hero" class="hero">
    <div class="layers">
      <div class="layer l-back"    data-depth="0.15"></div>
      <div class="layer l-midfar"  data-depth="0.25"></div>
      <div class="layer l-mid"     data-depth="0.4"></div>
      <div class="layer l-midnear" data-depth="0.6"></div>
      <div class="layer l-front"   data-depth="0.85"></div>
    </div>

    <div class="chips" aria-hidden="true">
      <div class="chip c1" data-mdepth="0.8">Performance</div>
      <div class="chip c2" data-mdepth="1.2">Creative</div>
      <div class="chip c3" data-mdepth="1.6">ScrollTrigger</div>
      <div class="chip c4" data-mdepth="2.0">GSAP</div>
    </div>

    <div class="headline">
      <div class="kicker">Parallax Playground</div>
      <h1>多層深度 × 滑鼠視差 × 針住時間軸</h1>
      <p>前中後景不同速度移動；滑鼠微幅帶動前景；整區塊釘住，滾動中播放動畫時間軸。</p>
    </div>
  </section>

  <!-- ===== Horizontal parallax (vertical scroll drives horizontal track) ===== -->
  <section id="hstrip" class="hstrip">
    <div class="wrap">
      <div class="card" style="margin-bottom:16px">
        <h2>橫向視差</h2>
        <p>縱向滾動時，整條內容水平移動；每個面板再附加微幅視差，增添層次。</p>
      </div>
      <div class="track">
        <div class="panel p1" data-shift="8"></div>
        <div class="panel p2" data-shift="-6"></div>
        <div class="panel p3" data-shift="10"></div>
        <div class="panel p4" data-shift="-8"></div>
      </div>
    </div>
  </section>

  <!-- ===== Clip-path text reveal + background parallax ===== -->
  <section id="reveal" class="reveal">
    <div class="bg"></div>
    <div class="wrap card">
      <h2 class="mask">文字遮罩進場</h2>
      <p class="mask">標題與段落使用 <code>clip-path</code> 由左至右揭示，同步背景以較慢速度上移，形成視差。</p>
      <p class="mask">這種做法適合章節開頭，搭配圖片或影片背景，保持內容清晰可讀。</p>
    </div>
  </section>

  <!-- ===== Cards with depth offsets ===== -->
  <section id="cards">
    <div class="wrap">
      <div class="card" style="margin-bottom:16px">
        <h2>卡片群 × 深度偏移</h2>
        <p>卡片在進入視口時由下往上飛入、淡入，並根據索引添加不同位移，營造空間感。</p>
      </div>
      <div class="grid">
        <div class="card depth" data-dz="12"><h3>A</h3><p>入場位移 +12%</p></div>
        <div class="card depth" data-dz="8"><h3>B</h3><p>入場位移 +8%</p></div>
        <div class="card depth" data-dz="5"><h3>C</h3><p>入場位移 +5%</p></div>
        <div class="card depth" data-dz="3"><h3>D</h3><p>入場位移 +3%</p></div>
        <div class="card depth" data-dz="2"><h3>E</h3><p>入場位移 +2%</p></div>
        <div class="card depth" data-dz="1"><h3>F</h3><p>入場位移 +1%</p></div>
      </div>
    </div>
  </section>

  <!-- GSAP & ScrollTrigger -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/ScrollTrigger.min.js"></script>
  <script>
    gsap.registerPlugin(ScrollTrigger);

    // ========= HERO PIN + MULTI-DEPTH PARALLAX =========
    const hero = document.querySelector('#hero');
    const layers = gsap.utils.toArray('#hero .layer');

    // 釘住 Hero，並在釘住期間做一段小時間軸（例如標題輕微放大/抬升）
    const heroTl = gsap.timeline({
      scrollTrigger: {
        trigger: hero,
        start: 'top top',
        end: '+=140%', // 釘住距離
        scrub: true,
        pin: true,
        anticipatePin: 1
        // markers: true
      }
    });

    heroTl
      .fromTo('.hero .headline', { yPercent: 8, autoAlpha: 0.85, scale: 0.98 },
                               { yPercent: -6, autoAlpha: 1,   scale: 1.02, ease: 'none' }, 0);

    // 視差：不同 depth 以不同幅度移動（數字越小越遠，移動越少）
    layers.forEach(layer => {
      const d = parseFloat(layer.dataset.depth || '0.5'); // 0~1
      gsap.fromTo(layer,
        { yPercent:  20 * (1 - d) },
        { yPercent: -20 * (1 - d), ease: 'none',
          scrollTrigger: {
            trigger: hero,
            start: 'top top',
            end: 'bottom top',
            scrub: true,
            invalidateOnRefresh: true
          }
        });
    });

    // 滑鼠視差（前景 chip 跟手移動）
    const chips = gsap.utils.toArray('.chip');
    let mx = 0, my = 0;
    window.addEventListener('pointermove', (e) => {
      const rect = hero.getBoundingClientRect();
      // 正規化為 -1 ~ 1
      mx = ((e.clientX - rect.left) / rect.width) * 2 - 1;
      my = ((e.clientY - rect.top) / rect.height) * 2 - 1;
    });
    gsap.ticker.add(() => {
      chips.forEach(ch => {
        const md = parseFloat(ch.dataset.mdepth || '1'); // 深度倍率
        gsap.to(ch, { x: mx * 20 * md, y: my * 14 * md, duration: 0.2, overwrite: true });
      });
    });

    // ========= HORIZONTAL PARALLAX STRIP =========
    const track = document.querySelector('.track');
    const panels = gsap.utils.toArray('.panel');
    const totalWidth = () => {
      // 計算 track 寬度 (所有 panel + gap)
      const gap = parseFloat(getComputedStyle(track).columnGap || getComputedStyle(track).gap || 16);
      return panels.reduce((w, el) => w + el.getBoundingClientRect().width, 0) + gap * (panels.length - 1);
    };

    ScrollTrigger.matchMedia({
      // 桌面版：開啟橫向滑動
      "(min-width: 768px)": function() {
        const distance = () => totalWidth() - track.parentElement.getBoundingClientRect().width;

        gsap.to(track, {
          x: () => -distance(),
          ease: "none",
          scrollTrigger: {
            trigger: '.hstrip .wrap',
            start: 'top top+=10%',
            end: () => `+=${distance() + window.innerHeight * 0.6}`,
            scrub: true,
            pin: true,
            anticipatePin: 1,
            invalidateOnRefresh: true
            // markers: true
          }
        });

        // 每個面板小幅上下偏移（製造二次視差）
        panels.forEach(p => {
          const shift = parseFloat(p.dataset.shift || 0);
          gsap.fromTo(p, { yPercent: shift }, {
            yPercent: -shift,
            ease: 'none',
            scrollTrigger: {
              trigger: '.hstrip .wrap',
              start: 'top bottom',
              end: 'bottom top',
              scrub: true
            }
          });
        });
      },
      // 手機版：不 pin、不水平移（保守）
      "(max-width: 767px)": function() {
        panels.forEach(p => {
          const shift = parseFloat(p.dataset.shift || 0);
          gsap.fromTo(p, { yPercent: shift }, {
            yPercent: -shift,
            ease: 'none',
            scrollTrigger: {
              trigger: p,
              start: 'top bottom',
              end: 'bottom top',
              scrub: true
            }
          });
        });
      }
    });

    // ========= REVEAL + BG PARALLAX =========
    // 背景慢移
    gsap.to('.reveal .bg', {
      yPercent: -20,
      ease: 'none',
      scrollTrigger: {
        trigger: '.reveal',
        start: 'top bottom',
        end: 'bottom top',
        scrub: true
      }
    });

    // clip-path 由左至右揭示
    gsap.utils.toArray('.reveal .mask').forEach((el, i) => {
      gsap.fromTo(el,
        { clipPath: 'inset(0 100% 0 0 round 12px)', y: 20, autoAlpha: 0 },
        {
          clipPath: 'inset(0 0% 0 0 round 12px)', y: 0, autoAlpha: 1, duration: 0.8, delay: i * 0.06,
          scrollTrigger: {
            trigger: el,
            start: 'top 85%',
            toggleActions: 'play none none reverse'
          }
        });
    });

    // ========= CARDS DEPTH ENTER =========
    gsap.utils.toArray('.depth').forEach((el) => {
      const dz = parseFloat(el.dataset.dz || 6);
      gsap.from(el, {
        yPercent: dz, autoAlpha: 0, duration: 0.6,
        scrollTrigger: {
          trigger: el,
          start: 'top 88%',
          toggleActions: 'play none none reverse'
        }
      });
    });

    // ========= Reduced motion handling =========
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      ScrollTrigger.getAll().forEach(t => t.disable());
    }
  </script>
</body>
</html>
